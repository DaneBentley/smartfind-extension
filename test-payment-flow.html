<!DOCTYPE html>
<html>
<head>
    <title>SmartFind Payment Flow Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        input, button { margin: 5px; padding: 8px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>üß™ SmartFind Payment Flow Test</h1>
    
    <div class="test-section">
        <h3>1. Token Calculation Test</h3>
        <label>Amount ($): <input type="number" id="test-amount" value="15" min="1" max="500" step="0.01"></label>
        <button onclick="testTokenCalculation()">Calculate Tokens</button>
        <div id="token-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. API Payload Test</h3>
        <label>User ID: <input type="text" id="test-user-id" value="test_user_123"></label>
        <label>Amount ($): <input type="number" id="test-api-amount" value="25" min="1" max="500" step="0.01"></label>
        <button onclick="testAPIPayload()">Generate Payload</button>
        <div id="api-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Real-time Update Test</h3>
        <label>Amount ($): <input type="number" id="live-amount" value="10" min="1" max="500" step="0.01" oninput="updateLiveDisplay()"></label>
        <div>You'll get <span id="live-tokens">1000</span> tokens (100 tokens per $1)</div>
    </div>
    
    <div class="test-section">
        <h3>4. Validation Test</h3>
        <label>Test Amount ($): <input type="number" id="validation-amount" value="0.5" step="0.01"></label>
        <button onclick="testValidation()">Validate</button>
        <div id="validation-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>5. Extension Integration Test</h3>
        <p>This section tests if the extension is loaded and working:</p>
        <button onclick="testExtensionIntegration()">Test Extension</button>
        <div id="extension-result" class="result"></div>
    </div>

    <script>
        // Test token calculation
        function testTokenCalculation() {
            const amount = parseFloat(document.getElementById('test-amount').value) || 0;
            const tokens = Math.floor(amount * 100);
            const result = document.getElementById('token-result');
            
            result.innerHTML = `
                <strong>Input:</strong> $${amount}<br>
                <strong>Tokens:</strong> ${tokens.toLocaleString()}<br>
                <strong>Rate:</strong> ${tokens / amount} tokens per dollar<br>
                <strong>Cost per token:</strong> ${(amount / tokens * 100).toFixed(2)}¬¢
            `;
            result.className = 'result success';
        }
        
        // Test API payload generation
        function testAPIPayload() {
            const userId = document.getElementById('test-user-id').value;
            const amount = parseFloat(document.getElementById('test-api-amount').value) || 0;
            const tokens = Math.floor(amount * 100);
            const amountInCents = Math.round(amount * 100);
            
            const payload = {
                userId: userId,
                amount: amount
            };
            
            const stripeData = {
                unit_amount: amountInCents,
                product_name: 'SmartFind Tokens',
                product_description: `${tokens} AI search tokens for SmartFind extension`,
                metadata: {
                    userId: userId,
                    tokenAmount: tokens.toString(),
                    customAmount: amount.toString()
                }
            };
            
            const result = document.getElementById('api-result');
            result.innerHTML = `
                <strong>API Payload:</strong><br>
                <pre>${JSON.stringify(payload, null, 2)}</pre>
                <strong>Stripe Data:</strong><br>
                <pre>${JSON.stringify(stripeData, null, 2)}</pre>
            `;
            result.className = 'result success';
        }
        
        // Update live display
        function updateLiveDisplay() {
            const amount = parseFloat(document.getElementById('live-amount').value) || 0;
            const tokens = Math.floor(amount * 100);
            document.getElementById('live-tokens').textContent = tokens.toLocaleString();
        }
        
        // Test validation
        function testValidation() {
            const amount = parseFloat(document.getElementById('validation-amount').value);
            const result = document.getElementById('validation-result');
            
            let isValid = true;
            let errors = [];
            
            if (isNaN(amount)) {
                isValid = false;
                errors.push('Amount is not a valid number');
            }
            
            if (amount < 1) {
                isValid = false;
                errors.push('Amount is below minimum ($1)');
            }
            
            if (amount > 500) {
                isValid = false;
                errors.push('Amount is above maximum ($500)');
            }
            
            if (isValid) {
                const tokens = Math.floor(amount * 100);
                result.innerHTML = `
                    <strong>‚úÖ Valid!</strong><br>
                    Amount: $${amount}<br>
                    Tokens: ${tokens.toLocaleString()}
                `;
                result.className = 'result success';
            } else {
                result.innerHTML = `
                    <strong>‚ùå Invalid!</strong><br>
                    Errors: ${errors.join(', ')}
                `;
                result.className = 'result error';
            }
        }
        
        // Test extension integration
        function testExtensionIntegration() {
            const result = document.getElementById('extension-result');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                result.innerHTML = `
                    <strong>‚úÖ Chrome Extension API Available</strong><br>
                    Extension ID: ${chrome.runtime.id}<br>
                    <button onclick="testExtensionMessage()">Test Message Passing</button>
                `;
                result.className = 'result success';
            } else {
                result.innerHTML = `
                    <strong>‚ùå Chrome Extension API Not Available</strong><br>
                    This page needs to be loaded in a Chrome extension context.
                `;
                result.className = 'result error';
            }
        }
        
        // Test extension message passing
        function testExtensionMessage() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: "purchaseTokens",
                    amount: 15.50
                }, (response) => {
                    const result = document.getElementById('extension-result');
                    result.innerHTML += `<br><strong>Message Response:</strong><br><pre>${JSON.stringify(response, null, 2)}</pre>`;
                });
            }
        }
        
        // Initialize
        updateLiveDisplay();
        
        console.log('üß™ SmartFind Payment Flow Test Page Loaded');
        console.log('Use the buttons above to test different aspects of the payment system');
    </script>
</body>
</html> 